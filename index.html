<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Player Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/mpegts.js@latest/dist/mpegts.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background-color: #000; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            font-family: sans-serif;
            overflow: hidden;
        }
        .container { width: 100%; height: 100%; display: flex; flex-direction: column; }
        video { 
            width: 100%; 
            height: 100%; 
            object-fit: contain; /* MantÃ©m a proporÃ§Ã£o da imagem */
            cursor: pointer;
        }
        /* Overlay de aviso caso o autoplay seja bloqueado */
        #unmute-notice {
            position: absolute;
            top: 20px;
            background: rgba(255, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            display: none;
            z-index: 100;
        }
    </style>
</head>
<body>

    <div id="unmute-notice" onclick="unmute()">ðŸ”ˆ Clique para ativar o som</div>

    <div class="container">
        <video id="videoElement" controls autoplay muted playsinline></video>
    </div>

    <script>
        var videoElement = document.getElementById('videoElement');
        var notice = document.getElementById('unmute-notice');

        if (mpegts.getFeatureList().mseLivePlayback) {
            var player = mpegts.createPlayer({
                type: 'mse',
                isLive: true,
                url: '/api/proxy',
                cors: true
            }, {
                enableWorker: true,            // Usa processamento em segundo plano
                enableStashBuffer: false,      // Reduz o atraso (baixa latÃªncia)
                stashInitialSize: 128,         // ComeÃ§a rÃ¡pido
                lazyLoad: false,
                autoCleanupSourceBuffer: true  // Limpa a memÃ³ria automaticamente
            });
            
            player.attachMediaElement(videoElement);
            player.load();
            player.play();

            // Mostra aviso de som se comeÃ§ar mutado
            videoElement.onplay = function() {
                if (videoElement.muted) {
                    notice.style.display = 'block';
                }
            };
        }

        function unmute() {
            videoElement.muted = false;
            notice.style.display = 'none';
        }

        // Sistema de auto-reconexÃ£o em caso de erro de rede
        player.on(mpegts.Events.ERROR, (type, detail, info) => {
            console.log("Erro detectado, reiniciando em 3s...");
            setTimeout(() => {
                player.unload();
                player.load();
                player.play();
            }, 3000);
        });

        // Tentar dar play novamente se houver bloqueio do navegador
        document.body.addEventListener('click', function() {
            if (videoElement.paused) videoElement.play();
        });
    </script>
</body>
</html>
